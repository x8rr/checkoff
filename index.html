<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkoff | The Better To-Do List</title>
    <link rel="shortcut icon" href="/assets/img/branding/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/colors/default.css" id="csslink">
    <link rel="stylesheet" href="/assets/css/index.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * {
            font-family: "Plus Jakarta Sans";
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="transition-colors duration-200">
    <br><br>
    <div class="hac" style="text-align: center;">
        <img src="/assets/img/branding/logo.png" class="homelogo hac" style="position: relative;" alt="Checkoff Logo">
        <h1
            class="text-4xl mt-2 font-black text-transparent bg-gradient-to-r from-sky-500 to-blue-600 bg-clip-text p-2">
            Checkoff</h1>
        <p class="font-medium theme-text-sub">Keep your tasks moving forward.</p>
        <br>
        <div class="flex flex-row content-center">
            <div
                class="bg-red-400/25 p-4 w-1/4 shadow-md theme-ring ring text-red-800 dark:text-red-400 font-black mr-2 rounded-3xl">
                <span id="overduecount2" class="text-2xl">0</span><br>
                <span class="text-xs opacity-75">OVERDUE</span>
            </div>
            <div
                class="bg-yellow-400/25 p-4 shadow-md theme-ring ring text-yellow-800 dark:text-yellow-400 font-black w-1/4 mr-2 ml-2 rounded-3xl">
                <span id="todocount2" class="text-2xl">0</span><br>
                <span class="text-xs opacity-75">TO DO</span>
            </div>
            <div
                class="bg-green-400/25 p-4 shadow-md theme-ring ring text-green-800 dark:text-green-400 font-black w-1/4 mr-2 ml-2 rounded-3xl">
                <span id="donecount2" class="text-2xl">0</span><br>
                <span class="text-xs opacity-75">DONE</span>
            </div>
            <div
                class="bg-blue-400/25 p-4 w-1/4 shadow-md theme-ring ring text-blue-800 dark:text-blue-400 font-black ml-2 rounded-3xl">
                <span id="totalcount" class="text-2xl">0</span><br>
                <span class="text-xs opacity-75">TOTAL</span>
            </div>
        </div>
        <br>
        <div onclick="newTaskModal()"
            class="theme-card transition-all mb-10 relative duration-200 hover:opacity-80 cursor-pointer flex flex-row content-center p-5 w-132 pt-10 pb-10 rounded-3xl theme-text-main h-fit shadow-2xl shadow-sky-500/50">
            <div class="rounded-[15px] bg-sky-400/50 mr-4 cursor-pointer text-sky-500 h-12 w-12 p-[11px] -mt-4 -mb-4">
                <i data-lucide="plus"></i>
            </div>
            <input style="pointer-events: none !important;" type="text"
                class="bg-none cursor-pointer outline-none border-none text-sky-600 font-bold w-3/4 -mt-2 -mb-2"
                placeholder="What are you doing today?">
        </div>

        <div id="overdue"
            class="relative left-1/2 -translate-x-1/2 flex flex-col items-center w-132 content-center justify-center hidden">
            <div class="flex flex-row items-left w-132">
                <div class="bg-red-500 w-2 h-8 rounded-md"></div>
                <span class="font-black text-lg theme-text-main mt-0.5 ml-4">Overdue Tasks</span>
                <span id="overduecount"
                    class="theme-card h-8 w-8 p-1 rounded-[12px] ml-4 font-bold text-red-400 shadow-lg shadow-red-500/15">0</span>
            </div><br>
            <div class="flex flex-col w-full" id="overduecontainer"></div>
            <br><br>
        </div>

        <div id="todo"
            class="relative left-1/2 -translate-x-1/2 flex flex-col items-center w-132 content-center justify-center">
            <div class="flex flex-row items-left w-132">
                <div class="bg-blue-400 w-2 h-8 rounded-md"></div>
                <span class="font-black text-lg theme-text-main mt-0.5 ml-4">Remaining Tasks</span>
                <span id="todocount"
                    class="theme-card h-8 w-8 p-1 rounded-[12px] ml-4 font-bold text-gray-400 shadow-lg shadow-sky-500/15">0</span>
            </div><br>
            <div class="flex flex-col w-full" id="todocontainer"></div>
        </div>
        <br><br>
        <div id="done"
            class="relative left-1/2 -translate-x-1/2 flex flex-col items-center w-132 content-center justify-center">
            <div class="flex flex-row items-left w-132 relative">
                <div class="bg-green-400 w-2 h-8 rounded-md"></div>
                <span class="font-black text-lg theme-text-main mt-0.5 ml-4">Completed Tasks</span>
                <span id="donecount"
                    class="theme-card h-8 w-8 p-1 rounded-[12px] ml-4 font-bold text-gray-400 shadow-lg shadow-sky-500/15">0</span>
                <button onclick="clearCompleted()"
                    class="absolute right-0 cursor-pointer transition-all duration-200 hover:bg-red-200 hover:scale-105 hover:-translate-y-0.5 mt-0.5 text-sm flex bg-red-100/50 ring ring-red-400/75 text-red-800 font-semibold p-2 h-fit w-fit rounded-[15px] -mt-1">
                    <i data-lucide="trash-2" class="mt-0.5" style="height: 16px;"></i> Clear
                </button>
            </div><br>
            <div id="donecontainer" class="flex flex-col w-full"></div>
        </div>
    </div>
    <div id="newTaskModal"
        class="scale-95 opacity-0 pointer-events-none theme-card transition-all duration-200 shadow-2xl shadow-sky-500/25 p-10 fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 rounded-4xl h-fit w-96"
        style="z-index: 10 !important;">
        <h1 class="text-2xl font-extrabold theme-text-main">New Task</h1><br>
        <input type="text" id="task-title"
            class="w-full h-14 p-4 rounded-2xl mb-4 bg-transparent border theme-border theme-text-main font-semibold placeholder:font-semibold placeholder:text-slate-400 shadow-sm transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-sky-500/20"
            placeholder="What needs to be done?">
        <input type="date" id="task-date"
            class="w-full h-14 p-4 rounded-2xl mb-4 bg-transparent border theme-border theme-text-main font-semibold shadow-sm focus:outline-none focus:ring-4 focus:ring-sky-500/20">
        <div class="flex flex-row items-center justify-end gap-3 mt-4">
            <button type="button" onclick="closeTaskModal()"
                class="px-5 py-2.5 rounded-[15px] ring-[1.5px] ring-gray-300/50 cursor-pointer theme-text-sub font-medium hover:bg-slate-100">Cancel</button>
            <button type="submit"
                onclick="addTask(document.getElementById('task-title').value.trim(), document.getElementById('task-date').value)"
                class="px-6 py-2.5 rounded-[15px] cursor-pointer bg-gradient-to-r from-sky-500 to-blue-600 text-white font-bold shadow-lg shadow-sky-200">Add
                Task</button>
        </div>
    </div>
    <div id="overlay" class="w-full hidden h-full fixed left-0 top-0 bg-black/80 backdrop-blur-sm" style="z-index: 0;">
    </div>

    <div class="flex fixed flex-row-reverse bottom-4 right-4">
        <a href="https://github.com/x8rr/checkoff" target="_blank">
            <button
                class="cursor-pointer border-none rounded-[15px] ml-2 theme-card shadow-xl transition-all duration-200 hover:-translate-y-1 shadow-sky-500/25 flex items-center justify-center ring ring-sky-500/20 h-10 w-10">
                <i data-lucide="github" class="scale-75 text-blue-500"></i>
            </button>
        </a>
        <button onclick="lightDark()"
            class="cursor-pointer border-none rounded-[15px] ml-2 theme-card shadow-xl transition-all duration-200 hover:-translate-y-1 shadow-sky-500/25 flex items-center justify-center ring ring-sky-500/20 h-10 w-10">
            <i data-lucide="sun-moon" class="scale-75 text-blue-500"></i>
        </button>
        <button onclick="exportTasks()"
            class="cursor-pointer border-none rounded-[15px] ml-2 theme-card shadow-xl transition-all duration-200 hover:-translate-y-1 shadow-sky-500/25 flex items-center h-10 px-4 text-sm font-semibold text-sky-600 ring ring-sky-500/20">
            <i data-lucide="upload" class="scale-75 text-blue-500 mr-1"></i> Export
        </button>
        <button onclick="importTasks()"
            class="cursor-pointer border-none rounded-[15px] ml-2 theme-card shadow-xl transition-all duration-200 hover:-translate-y-1 shadow-sky-500/25 flex items-center h-10 px-4 text-sm font-semibold text-sky-600 ring ring-sky-500/20">
            <i data-lucide="download" class="scale-75 text-blue-500 mr-1"></i> Import
        </button>
    </div>
    <script>
        async function loadIcons() { await lucide.createIcons() }

        function newTaskModal() {
            document.getElementById("overlay").classList.remove("hidden")
            document.getElementById("newTaskModal").classList.remove("scale-95", "opacity-0", "pointer-events-none")
        }

        function closeTaskModal() {
            document.getElementById("overlay").classList.add("hidden")
            document.getElementById("newTaskModal").classList.add("scale-95", "opacity-0", "pointer-events-none")
        }

        function addTask(t, d) {
            if (!t) return
            const saved = JSON.parse(localStorage.getItem("checkoff_savedTasks")) ?? []
            const newTask = { id: Date.now(), title: t, dueDate: d, status: "todo" }
            saved.push(newTask)
            localStorage.setItem("checkoff_savedTasks", JSON.stringify(saved))
            document.getElementById("task-title").value = ""
            document.getElementById("task-date").value = ""
            closeTaskModal()
            loadTasks()
        }

        function checkoff(taskId) {
            let saved = JSON.parse(localStorage.getItem("checkoff_savedTasks")) ?? []
            saved = saved.map(t => t.id === taskId ? { ...t, status: "done" } : t)
            localStorage.setItem("checkoff_savedTasks", JSON.stringify(saved))
            setTimeout(loadTasks, 500)
        }

        function clearCompleted() {
            let saved = JSON.parse(localStorage.getItem("checkoff_savedTasks")) ?? []
            saved = saved.filter(t => t.status !== "done")
            localStorage.setItem("checkoff_savedTasks", JSON.stringify(saved))
            loadTasks()
        }

        function exportTasks() {
            const saved = localStorage.getItem("checkoff_savedTasks") ?? "[]"
            const blob = new Blob([saved], { type: "application/json" })
            const url = URL.createObjectURL(blob)
            const a = document.createElement("a")
            a.href = url
            a.download = "checkoff_backup_" + Date.now() + ".json"
            a.click()
            URL.revokeObjectURL(url)
        }

        function importTasks() {
            const inp = document.createElement("input")
            inp.type = "file"
            inp.accept = ".json"
            inp.onchange = (e) => {
                const f = e.target.files[0]
                if (!f) return
                const r = new FileReader()
                r.onload = (ev) => {
                    const imported = JSON.parse(ev.target.result)
                    if (Array.isArray(imported)) {
                        const current = JSON.parse(localStorage.getItem("checkoff_savedTasks") ?? "[]")
                        const comb = [...current, ...imported]
                        const unq = Array.from(new Map(comb.map(i => [i.id, i])).values())
                        localStorage.setItem("checkoff_savedTasks", JSON.stringify(unq))
                        loadTasks()
                    }
                }
                r.readAsText(f)
            }
            inp.click()
        }

        function loadTasks() {
            const todoContainer = document.getElementById("todocontainer")
            const doneContainer = document.getElementById("donecontainer")
            const overdueContainer = document.getElementById("overduecontainer")
            const overdueSection = document.getElementById("overdue")
            const saved = JSON.parse(localStorage.getItem("checkoff_savedTasks")) ?? []

            let counts = { todo: 0, done: 0, overdue: 0 }
            todoContainer.innerHTML = ""
            doneContainer.innerHTML = ""
            overdueContainer.innerHTML = ""

            const today = new Date().setHours(0, 0, 0, 0)

            saved.forEach(t => {
                const isDone = t.status === "done"
                const taskDate = t.dueDate ? new Date(t.dueDate).setHours(0, 0, 0, 0) : null
                const isOverdue = !isDone && taskDate && taskDate < today

                const taskEl = document.createElement("div")
                taskEl.className = `theme-card shadow-2xl flex flex-row items-start mb-4 shadow-sky-500/25 w-full p-5 rounded-3xl ${isDone ? 'opacity-25' : ''}`

                const dateColor = isOverdue ? 'text-red-500' : 'theme-text-sub'
                const dateInfo = t.dueDate ? `<div class="text-xs ${dateColor} font-bold flex items-center mt-1"><i data-lucide="calendar" class="w-3 h-3 mr-1"></i>${t.dueDate}</div>` : ""

                taskEl.innerHTML = `
            <label class="ios-checkbox top-1/2 translate-y-1/4 blue relative mr-1 mt-1">
                <input type="checkbox" ${isDone ? 'checked disabled' : `onchange="checkoff(${t.id})"`} />
                <div class="checkbox-wrapper">
                    <div class="checkbox-bg"></div>
                    <svg class="checkbox-icon" viewBox="0 0 24 24" fill="none">
                        <path class="check-path" d="M4 12L10 18L20 6" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </div>
            </label>
            <div class="flex flex-col ml-3 text-left">
                <span class="font-bold theme-text-main text-[17px] mt-0.5">${t.title}</span>
                ${dateInfo}
            </div>`

                if (isDone) {
                    counts.done++
                    doneContainer.prepend(taskEl)
                } else if (isOverdue) {
                    counts.overdue++
                    overdueContainer.prepend(taskEl)
                } else {
                    counts.todo++
                    todoContainer.prepend(taskEl)
                }
            })

            if (counts.todo === 0 && counts.overdue === 0) {
                todoContainer.innerHTML = `<div class="w-full rounded-4xl bg-gray-100/25 p-5 border border-dashed theme-text-sub border-gray-300 h-45 relative"><div class="absolute left-1/2 top-1/2 items-center flex-col flex text-center -translate-y-1/2 -translate-x-1/2"><i data-lucide="party-popper" class="scale-150 mb-4"></i><h1 class="font-bold text-2xl theme-text-main">Nice!</h1><p class="font-medium theme-text-sub">You're all caught up.</p></div></div>`
            }

            if (counts.overdue > 0) {
                overdueSection.classList.remove("hidden")
            } else {
                overdueSection.classList.add("hidden")
            }

            document.getElementById("todocount").textContent = counts.todo
            document.getElementById("todocount2").textContent = counts.todo
            document.getElementById("donecount").textContent = counts.done
            document.getElementById("donecount2").textContent = counts.done
            document.getElementById("overduecount").textContent = counts.overdue
            document.getElementById("overduecount2").textContent = counts.overdue
            document.getElementById("totalcount").textContent = saved.length
            lucide.createIcons()
        }

        loadTasks()

        function lightDark() {
            const html = document.documentElement;
            const isNowDark = html.classList.toggle("dark");
            localStorage.setItem("checkoff_prefersLight", isNowDark ? "no" : "yes");
            const cssLink = document.getElementById("csslink");
            cssLink.href = isNowDark ? "/assets/css/colors/dark.css" : "/assets/css/colors/default.css";
        }

        (function initTheme() {
            const saved = localStorage.getItem("checkoff_prefersLight") ?? "yes";
            const html = document.documentElement;
            const cssLink = document.getElementById("csslink");

            if (saved === "no") {
                cssLink.href = "/assets/css/colors/dark.css";
                html.classList.add("dark");
            } else {
                cssLink.href = "/assets/css/colors/default.css";
                html.classList.remove("dark");
            }
        })();
    </script>
</body>

</html>